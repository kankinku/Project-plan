## Repository Layout & Naming Conventions

- **문서 ID**: DOC-002
    
- **제목**: Repo Layout & Naming Conventions
    
- **버전**: 1.0
    
- **목표**: 파일/폴더/ID/이벤트 이름을 규격화해 “아티팩트 찾기, 재현, 디버깅” 시간을 줄인다.
    

---

## 1) 권장 디렉토리 구조

```
docs/                  # DOC/SYS/PIPE 문서
schemas/               # SCHEMA-* + validators
obs/                   # OBS-* + validators
modules/               # MOD-* 구현
pipelines/             # PIPE-* 구현
tests/                 # TEST-* (unit/integration/regression)
configs/               # run profiles, model params, policy versions

artifacts/
  runs/<run_id>/
    run_metadata.json          # OBS-530
    dq_checks.jsonl            # OBS-540
    iterations/<iteration_id>/
      candidates.jsonl         # generator outputs (pre-dedup optional)
      deduped.jsonl            # post-normalize/hash (MOD-412)
      shortlist.jsonl
      metrics/
        <strategy_id>.json     # SCHEMA-340
      logs/
        decisions.jsonl        # OBS-500 (if enabled)
        orders_fills.jsonl     # OBS-510 (if enabled)
        trades.jsonl           # OBS-520
      reports/
        tearsheet.md|pdf|html
    db.sqlite                  # MOD-460 (정형 저장)
```

---

## 2) 파일 포맷 규칙

- **대량 레코드**: JSONL(한 줄 한 레코드), 필요 시 `.jsonl.gz`
    
- **단일 스냅샷/설정**: JSON
    
- **리포트**: md/html/pdf (단, 원천 데이터는 JSON/JSONL이 진실의 근원)
    

---

## 3) 파일명/키 네이밍 규칙

### 3.1 문서/스키마/로그 파일명

- 문서는 ID를 파일명에 포함:
    
    - `DOC-001.md`, `SYS-100.md`, `MOD-400.md`
        
- 스키마/OBS도 동일:
    
    - `SCHEMA-340.json`, `OBS-520.json`
        

### 3.2 공통 키(로그/메트릭/DB 공통)

가능한 모든 레코드는 아래 키를 포함한다.

- `run_id`
    
- `iteration_id`
    
- `strategy_id`
    

주문/체결/트레이드 레코드에는 추가로:

- `order_id` (OBS-510)
    
- `trade_id` (OBS-520)
    
- `symbol`
    
- `timestamp`(또는 `t`)
    

---

## 4) 시간/타임존 규칙

- 시간은 ISO-8601 권장: `YYYY-MM-DDTHH:MM:SSZ`
    
- timezone이 UTC가 아니라면:
    
    - run 단위 `timezone`을 **OBS-530**에 반드시 기록
        
- bar 기준 시간은 “bar_end” 또는 “bar_start”를 정책으로 고정하고 문서화(권장: bar_end)
    

---

## 5) 코드 네이밍(권장)

- 모듈 파일: `mod_400_orchestrator.py` 처럼 **문서 ID 매핑**
    
- 클래스/인터페이스:
    
    - `BacktestEngineAdapter`
        
    - `CostModel`, `ExecutionModel`, `PortfolioModel`
        
- reason_codes: 대문자 스네이크
    
    - `EXEC_SPREAD_TOO_WIDE`, `GATE_OOS_SHARPE_FAIL`
        

---

## 6) 버전/정책 네이밍

- scoring 정책: `score_v1`, `score_v2` (MOD-431 policy_version)
    
- cost/execution/portfolio 모델: `cost_v1`, `exec_v1`, `pf_v1`
    
- 데이터 버전: `data_vYYYY_MM_DD`
    
- 유니버스 버전: `u_vN`
    

---

## 7) 수용 기준

- `run_id`만 알면 `artifacts/runs/<run_id>/` 아래에서
    
    - **OBS-530/540**
        
    - iteration별 후보/shortlist
        
    - 전략별 SCHEMA-340
        
    - (검증 시) OBS-500/510/520  
        를 **역추적 가능**해야 한다.
        
- 스키마 validator 실패 데이터는 저장하지 않는다(권장: 저장 전 검증).
    

---
