## Report Generator (티어시트/아티팩트/요약)

- **문서 ID**: MOD-433
    
- **제목**: Report Generator Specification (Tearsheet & Artifacts)
    
- **버전**: 1.0
    
- **목표**: 전략 평가 결과를 사람이 빠르게 판단할 수 있도록 **표준 리포트(티어시트)** 와 **근거 아티팩트(로그/메트릭/차트)** 를 생성하고, Knowledge Base(MOD-460/461)에 저장 가능한 형태로 패키징한다.
    
- **범위**: 리포트 구성, 입력/출력, 아티팩트 디렉토리 규격, 차트/표 목록, 요약 규칙, 저장/링킹(OBS-530/SCHEMA-340 연동).
    
- **비범위**: 지표 계산(MOD-430), 점수화(MOD-431), 강건성 실행(MOD-432)
    

---

## 1) Report Generator 책임(Responsibilities)

1. **티어시트 생성**: 핵심 성과/리스크/실행품질을 1~3페이지 요약(사람용)
    
2. **근거 아티팩트 패키징**: metrics_json, trades, selected logs(OBS), robustness 케이스 요약
    
3. **차트 생성**: equity curve, drawdown, return distribution, rolling metrics, trade scatter 등
    
4. **요약 텍스트 생성**: “왜 좋은지/어디가 위험한지”를 규칙 기반으로 자동 요약
    
5. **저장/링킹**: run/iteration/strategy_id 기준으로 재현 가능한 경로에 저장하고 KB에 인덱싱
    

---

## 2) 입력/출력(Interface)

### 2.1 입력: `ReportRequest`

```json
{
  "run_id": "uuid",
  "iteration_id": 12,
  "strategy_id": "hash",

  "strategy_spec_ref": "db://strategies/hash",
  "metrics_json": { "...SCHEMA-340..." },
  "score": { "...MOD-431 ScoreResponse..." },

  "robustness": { "summary": { "...": "..." }, "cases_ref": "optional" },

  "artifacts_ref": {
    "trades_path": "path/to/obs520.jsonl",
    "orders_path": "path/to/obs510.jsonl",
    "decision_logs_path": "optional path/to/obs500.jsonl",
    "dq_checks_path": "path/to/obs540.jsonl",
    "run_metadata_path": "path/to/obs530.json"
  },

  "policy": {
    "report_level": "exploration|verification|final",
    "include_sections": ["overview","performance","risk","execution","robustness","diagnostics"],
    "charts": { "enabled": true, "format": "png", "dpi": 150 },
    "export": ["html","pdf","json_summary"]
  }
}
```

### 2.2 출력: `ReportResponse`

```json
{
  "strategy_id": "hash",
  "status": "SUCCESS|PARTIAL|FAILED",
  "report_paths": {
    "tearsheet_html": "path/tearsheet.html",
    "tearsheet_pdf": "path/tearsheet.pdf",
    "summary_json": "path/summary.json",
    "bundle_dir": "path/bundle/"
  },
  "kb_refs": {
    "doc_store_id": "optional",
    "db_record_id": "optional"
  },
  "warnings": []
}
```

---

## 3) 아티팩트 디렉토리 규격(표준)

```
artifacts/
  runs/<run_id>/
    strategies/<strategy_id>/
      report/
        tearsheet.html
        tearsheet.pdf
        summary.json
        charts/
          equity_curve.png
          drawdown.png
          rolling_sharpe.png
          return_hist.png
          trade_pnl_scatter.png
      data/
        metrics.json                (SCHEMA-340)
        score.json                  (MOD-431)
        robustness_summary.json     (MOD-432)
        robustness_cases.jsonl      (optional)
        trades.jsonl                (OBS-520)
        orders_fills.jsonl          (OBS-510)
        decision_logs.jsonl         (OBS-500, optional by policy)
        dq_checks.jsonl             (OBS-540)
        run_metadata.json           (OBS-530)
```

---

## 4) 티어시트 구성(권장 섹션)

### 4.1 Overview (1페이지 상단 요약)

- Strategy ID / family / tags / version info
    
- Score(total + breakdown)
    
- 핵심 지표 6개(권장)
    
    - CAGR(net), Sharpe(net), MaxDD(net), Calmar(net), Trade count, Costs total
        
- “합격/불합격” 및 fail reasons(있으면)
    

### 4.2 Performance

- equity curve
    
- rolling return(옵션)
    
- return distribution(hist)
    

### 4.3 Risk

- drawdown curve
    
- worst month/quarter(옵션)
    
- tail risk(있으면)
    

### 4.4 Execution / Costs

- costs breakdown(Fees/Spread/Slippage)
    
- slippage p50/p95, latency p95, reject/partial rates
    
- turnover(있으면)
    

### 4.5 Robustness

- WFA fold별 결과(표/미니차트)
    
- regime별 성과 비교
    
- param sensitivity 결과(분산/최악 케이스)
    

### 4.6 Diagnostics (근거/경고)

- DQ warnings (OBS-540)
    
- “주의 요인” 자동 요약(아래 규칙)
    

---

## 5) 차트 목록(최소 세트)

- `equity_curve.png` (누적 자본)
    
- `drawdown.png` (낙폭)
    
- `return_hist.png` (수익률 분포)
    
- `rolling_sharpe.png` (롤링 샤프, 옵션)
    
- `trade_pnl_scatter.png` (트레이드별 PnL/보유기간 산점도)
    

> 탐색 레벨(exploration)은 chart 최소화(시간 절약), 검증/최종은 풀 차트.

---

## 6) 자동 요약 규칙(Summary Heuristics)

Report Generator는 “설명 가능한 문장”을 규칙 기반으로 생성한다(LLM 의존 최소).

### 6.1 강점 요약(예)

- Sharpe_net ≥ 0.5 → “리스크 대비 수익이 양호”
    
- MaxDD ≥ -0.20 → “낙폭이 관리됨”
    
- costs_total 비중 낮음 → “비용 민감도 낮음”
    
- WFA pass rate 높음 → “시간 구간에 걸쳐 일관성”
    

### 6.2 위험 요약(예)

- OOS sharpe 급락 또는 retention < 0.7 → “OOS 유지율 낮음(과최적화 가능성)”
    
- slippage p95 높음 → “체결 민감도 큼(실행 리스크)”
    
- trade_count 매우 낮음 → “표본 부족”
    
- RISK_OFF에서 붕괴 → “레짐 편향”
    

요약 결과는 `summary.json`에 구조화하여도 저장:

```json
{
  "highlights": ["..."],
  "risks": ["..."],
  "action_items": ["..."]
}
```

---

## 7) Knowledge Base 저장/링킹(연동)

- 정형 DB(MOD-460):
    
    - `strategy_reports` 테이블에 `run_id, iteration_id, strategy_id, score, key_metrics, paths`
        
- 문서 스토어(MOD-461):
    
    - pdf/html/summary.json 업로드(또는 로컬 파일로 참조)
        
- Retriever(MOD-462)가 검색 가능하도록:
    
    - tags(oscillator/RSI/Stoch/ADX 등), 실패 태그, 레짐 편향 태그를 메타로 저장
        

---

## 8) 예외/에러 처리

- `MISSING_ARTIFACT`: trades/orders가 없으면 “축약 리포트”로 PARTIAL 생성
    
- `CHART_RENDER_FAIL`: 차트 일부 실패 시 warnings에 기록하고 나머지 생성
    
- `EXPORT_FAIL_PDF`: html만 생성 후 warning
    

---

## 9) 테스트 요구사항

- 동일 입력(동일 metrics/score) → 동일 summary.json(결정성)
    
- 아티팩트 경로가 규격에 맞게 생성되는지
    
- 누락 입력이 있어도 exploration 레벨에서 최소 리포트가 생성되는지
    
- pdf/html 내에 run/strategy 버전 정보가 반드시 포함되는지(재현성)
    

---

## 10) 다음 문서 연결

다음 모듈 세트는 Root-cause Analyzer 파트:

- **MOD-440 Failure Taxonomy**
    
- MOD-441 Analyzer Rules v0
    
- MOD-442 Evidence Builder
    

“다음”이라고 하면 **MOD-440**부터 하나씩 작성할게.