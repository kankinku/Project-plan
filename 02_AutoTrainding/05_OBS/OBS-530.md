
## Run Metadata Specification (재현성 메타데이터)

- **문서 ID**: OBS-530
    
- **제목**: Run Metadata Specification (Reproducibility Metadata)
    
- **버전**: 1.0
    
- **목표**: 동일 입력(데이터/코드/설정/시드)으로 **항상 동일 결과를 재현**할 수 있도록, 실행 단위(run/iteration/strategy)의 메타데이터를 표준화한다.
    
- **범위**: backtest/paper/live 공통. (live는 시장 데이터가 변하므로 “동일 스냅샷 데이터로의 리플레이”를 목표로 함)
    
- **비범위**: DB 물리 스키마(별도). 본 문서는 “저장해야 하는 메타 필드” 규격.
    

---

## 1) 메타데이터 레벨 정의

- **Run-level**: 전체 실행 세션(하나의 실험/운영 세션)
    
- **Iteration-level**: 생성→평가→분석→제약 반영을 1회 수행한 루프 단위
    
- **Strategy-level**: 특정 전략 후보(DSL/AST 포함) 1개 단위
    

---

## 2) Run Metadata (필수)

```json
{
  "schema_version": "1.0",
  "run_id": "uuid",
  "environment": "backtest|paper|live|dev",
  "status": "RUNNING|SUCCESS|FAILED|CANCELLED",

  "started_at": "2026-02-06T00:00:00Z",
  "finished_at": "2026-02-06T02:00:00Z",

  "project": {
    "name": "auto_trading_agent",
    "profile": "equity_us_daily"
  },

  "code": {
    "repo": "optional",
    "commit_hash": "gitsha",
    "dirty": false,
    "build_id": "optional",
    "python_version": "3.11.7",
    "dependencies_lock_hash": "hash-of-lockfile"
  },

  "data": {
    "data_version": "data_v2026_02_01",
    "universe_version": "u_v3",
    "vendor": "internal|polygon|binance|...",
    "bar_interval": "1d",
    "timezone": "America/New_York",
    "calendar": "NYSE",
    "period": { "start": "2015-01-01", "end": "2025-12-31" },
    "snapshot_id": "optional-for-live-replay",
    "integrity_hash": "hash-of-raw-files-or-manifest"
  },

  "engine": {
    "backtest_engine": "custom|vectorbt|backtrader|lean",
    "engine_version": "x.y.z",
    "execution_timing": "next_bar",
    "precision_mode": "float64"
  },

  "models": {
    "fees_model_version": "fees_v1",
    "slippage_model_version": "slip_v1",
    "spread_model_version": "spread_v1"
  },

  "randomness": {
    "seed": 42,
    "rng_alg": "pcg64",
    "determinism": "strict|best_effort"
  },

  "notes": "optional"
}
```

### 2.1 필수 체크(Validator)

- `run_id`, `started_at`, `environment`
    
- `code.commit_hash` 필수(backtest/paper), live는 build_id라도 필수
    
- `data.data_version`, `data.period`, `data.integrity_hash`
    
- `randomness.seed`
    

---

## 3) Iteration Metadata (권장)

```json
{
  "iteration_id": 12,
  "run_id": "uuid",
  "created_at": "2026-02-06T00:30:00Z",
  "status": "SUCCESS|FAILED|PARTIAL",

  "generator": { "version": "gen_v0", "mode": "template+llm", "constraints_set_id": "cs_01" },
  "scorer": { "version": "score_v1", "metric_schema_version": "1.0" },
  "analyzer": { "version": "anlz_v0", "taxonomy_version": "tax_v1" },

  "counts": {
    "generated": 500,
    "deduped": 320,
    "backtested": 200,
    "passed": 20,
    "selected": 5
  },

  "summary": {
    "best_strategy_id": "strat_abc",
    "best_score": 0.73
  }
}
```

---

## 4) Strategy Metadata (필수+권장)

Strategy DSL 자체는 SCHEMA-300으로 저장하고, 여기서는 “재현/추적용 링크”를 표준화한다.

```json
{
  "strategy_id": "hash",
  "run_id": "uuid",
  "iteration_id": 12,
  "schema_version": "1.0",
  "strategy_spec_hash": "sha256-of-canonical-dsl",
  "conditions_hashes": {
    "AST_ENTRY_1": "sha256",
    "AST_EXIT_1": "sha256"
  },
  "complexity": { "ast_depth": 3, "cmp_count": 6, "feature_count": 8 },
  "tags": ["rsi", "stoch", "adx"]
}
```

---

## 5) 저장 위치(권장)

- Run metadata: `runs` 테이블 또는 `runs.json` (아티팩트 폴더)
    
- Iteration metadata: `iterations` 테이블 + snapshot json
    
- Strategy metadata: `strategies` 테이블의 메타 컬럼 + spec json 저장
    

---

## 6) 다음 문서 연결

- 메트릭 계약(계산 조건): SCHEMA-340 `calc_contract`
    
- 룩어헤드/데이터 오류 결과: OBS-540
    
- 재현성 테스트: TEST-620
    

---
