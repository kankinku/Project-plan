
## Data Quality Checks Specification (데이터 품질/룩어헤드 검증 로그)

- **문서 ID**: OBS-540
    
- **제목**: Data Quality Checks Specification
    
- **버전**: 1.0
    
- **목표**: 백테스트/라이브에서 신뢰를 깨는 핵심 원인(룩어헤드/서바이버십/캘린더/결측/조정주가)을 **자동 점검**하고, 결과를 표준 로그로 남겨 “신뢰 가능한 백테스트”를 보장한다.
    
- **범위**: run-level + symbol-level + feature-level 체크 결과 로그.
    
- **비범위**: 체크 구현 코드(별도 모듈 문서에서).
    

---

## 1) Check Result 레코드 스키마

```json
{
  "schema_version": "1.0",
  "check_id": "uuid",
  "run_id": "uuid",
  "created_at": "2026-02-06T00:05:00Z",

  "check_name": "LOOKAHEAD|SURVIVORSHIP|CALENDAR|TIMEZONE|MISSING|CORP_ACTION|DUPLICATE_TS|EXECUTION_TIMING",
  "status": "PASS|WARN|FAIL",
  "severity": "INFO|WARN|ERROR|CRITICAL",

  "scope": "run|symbol|feature|engine",
  "symbol": "optional",
  "feature_name": "optional",

  "evidence": {},
  "recommended_actions": [],
  "reason_codes": ["DATA_LOOKAHEAD_DETECTED"]
}
```

### 1.1 필수

- `check_id`, `run_id`, `check_name`, `status`, `scope`, `severity`
    

---

## 2) 표준 체크 목록(최소 세트)

## 2.1 LOOKAHEAD_CHECK (룩어헤드)

- **목적**: 신호 계산/체결이 미래 정보를 사용하지 않는지 검증
    
- **PASS 조건 예**
    
    - 종가로 신호 생성 시 체결은 next_bar
        
- **FAIL 예**
    
    - signal_t == fill_t (same bar)로 체결된 기록 존재
        

**evidence 예**

```json
{
  "violations": [
    { "symbol": "AAPL", "timestamp": "2026-02-06", "detail": "same_bar_fill_detected" }
  ],
  "policy": { "execution_timing": "next_bar", "disallow_same_bar_fill": true }
}
```

**reason_codes**

- `DATA_LOOKAHEAD_DETECTED` (FAIL)
    
- `DATA_LOOKAHEAD_RISK` (WARN)
    

---

## 2.2 SURVIVORSHIP_CHECK (생존편향)

- **목적**: 유니버스가 “현재 생존 종목만”으로 구성되지 않았는지
    
- evidence: 유니버스 생성 방식, asof_date, delist 포함 여부
    
- reason_codes:
    
    - `DATA_SURVIVORSHIP_RISK`
        

---

## 2.3 CALENDAR/TIMEZONE_CHECK (캘린더/타임존)

- **목적**: 휴장일 바 존재/타임존 불일치/시계열 정렬 문제 검출
    
- evidence:
    
    - `duplicate_timestamps`, `missing_timestamps`, `holiday_bars`
        
- reason_codes:
    
    - `DATA_TIMEZONE_MISMATCH`, `DATA_CALENDAR_MISMATCH`, `DATA_DUPLICATE_TS`
        

---

## 2.4 MISSING_DATA_CHECK (결측/NaN)

- **목적**: feature NaN이 거래/평가에 영향을 주는지
    
- evidence:
    

```json
{
  "nan_rate_by_feature": { "rsi_14": 0.001, "stoch_k_14_3_3": 0.002 },
  "symbols_affected": ["AAPL", "MSFT"],
  "policy": { "on_nan_in_condition": "DISALLOW_TRADE" }
}
```

- reason_codes:
    
    - `DATA_MISSING`
        

---

## 2.5 CORP_ACTION_CHECK (분할/배당/조정)

- **목적**: split/배당으로 인한 수익률 스파이크, 조정주가 정책 불일치 탐지
    
- evidence:
    
    - `extreme_returns`, `split_dates`, `adjusted_price_policy`
        
- reason_codes:
    
    - `DATA_CORP_ACTION_ANOMALY`
        

---

## 2.6 EXECUTION_TIMING_CHECK (체결 규칙 준수)

- **목적**: 엔진이 SCHEMA-340 calc_contract의 execution_timing을 준수하는지
    
- reason_codes:
    
    - `DATA_EXECUTION_TIMING_VIOLATION`
        

---

## 3) recommended_actions 표준

각 체크는 “다음 행동”을 기계적으로 제안할 수 있어야 한다.

```json
"recommended_actions": [
  { "action": "set_execution_timing", "params": { "execution_timing": "next_bar" } },
  { "action": "enable_adjusted_prices", "params": { "policy": "adj_close" } },
  { "action": "exclude_symbols", "params": { "symbols": ["XYZ"] } }
]
```

---

## 4) PASS/WARN/FAIL 기준(권장)

- `PASS`: 위반 0
    
- `WARN`: 위반 소수이나 결과 해석에 영향 가능(예: NaN 0.5% 미만)
    
- `FAIL`: 룩어헤드/타임존/서바이버십 등 신뢰 붕괴 수준
    

---

## 5) 샘플 레코드(룩어헤드 FAIL)

```json
{
  "schema_version": "1.0",
  "check_id": "dq_001",
  "run_id": "run_001",
  "created_at": "2026-02-06T00:05:00Z",
  "check_name": "LOOKAHEAD",
  "status": "FAIL",
  "severity": "CRITICAL",
  "scope": "engine",
  "evidence": {
    "violations": [
      { "symbol": "AAPL", "timestamp": "2020-03-18", "detail": "fill_on_same_bar" }
    ],
    "policy": { "execution_timing": "next_bar", "disallow_same_bar_fill": true }
  },
  "recommended_actions": [
    { "action": "set_execution_timing", "params": { "execution_timing": "next_bar" } }
  ],
  "reason_codes": ["DATA_LOOKAHEAD_DETECTED"]
}
```

---

## 6) 다음 문서 연결

- 데이터 품질 체크 구현/파이프라인: PIPE-220(Backtest) / MOD-420(Backtester)
    
- 실패 분석(데이터 실패 카테고리): MOD-440/442
    
- 재현성 메타: OBS-530
    
- 테스트: TEST-630(백테스트 신뢰성 테스트)
    

---
